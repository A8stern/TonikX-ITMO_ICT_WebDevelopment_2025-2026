# Практические работы 3.1 и 3.2  
## Проект: Система управления гостиницей (Backend API)

---

## 1. Выбор варианта и согласование

Для выполнения практических работ **3.1** и **3.2** был выбран и реализован собственный вариант предметной области —  
**система управления гостиницей**.

Система предназначена для автоматизации работы гостиницы и включает три основные роли пользователей:

- **Client (клиент)** — просмотр отелей и типов номеров, проверка доступности, бронирование, оплата и отмена брони
- **Admin (администратор)** — управление номерами, бронированиями, заселениями и выселениями, персоналом и уборками
- **Cleaner (уборщик)** — выполнение и отметка уборок номеров

Выбранный функционал был согласован с преподавателем и используется далее для реализации клиентской части в лабораторной работе №4.

---

## 2. Модель базы данных (Django ORM)

Модель базы данных реализована средствами Django ORM и отражает предметную область гостиницы.  
Все связи между сущностями реализованы через `ForeignKey` и `OneToOneField`, соблюдены ограничения целостности данных.

---

### 2.1 Hotel (Отель)

**Поля:**
- `id_hotel` — первичный ключ
- `city` — город
- `name` — название отеля
- `num_of_rooms` — количество номеров
- `address` — адрес
- `image` — изображение отеля

**Назначение:** хранение информации об отелях, доступных клиентам для бронирования.

---

### 2.2 TypeOfRoom (Тип номера)

**Поля:**
- `id_type` — первичный ключ
- `name` — название типа номера
- `num_of_rooms` — количество номеров данного типа
- `num_of_free_rooms` — количество свободных номеров
- `num_of_places` — вместимость
- `base_price` — базовая цена за сутки
- `image` — изображение типа номера

**Назначение:** описание категорий номеров (стандарт, люкс и т.п.).

---

### 2.3 RoomInHotel (Номер)

**Поля:**
- `id_number` — первичный ключ
- `hotel` — ссылка на отель
- `room_type` — ссылка на тип номера
- `room_number` — номер комнаты
- `places_number` — количество мест
- `status` — статус (Свободен / Занят)
- `cleaned` — состояние уборки

**Назначение:** хранение информации о конкретных номерах в отелях.

---

### 2.4 Client (Клиент)

**Поля:** имя, фамилия, отчество, адрес, телефон, email.

**Назначение:** данные клиентов, осуществляющих бронирование номеров.

---

### 2.5 Staff (Сотрудник)

**Поля:**
- `full_name` — ФИО сотрудника
- `job_title` — должность (Администратор, Уборщик и т.д.)

**Назначение:** сотрудники гостиницы, участвующие в заселениях и уборках.

---

### 2.6 Booking (Бронирование)

**Поля:**
- `id_book` — первичный ключ
- `book_status` — статус бронирования
- `date_start`, `date_end` — период проживания
- `hotel` — отель
- `client` — клиент
- `staff` — администратор
- `room_type` — тип номера
- `price` — стоимость
- `payed` — оплаченная сумма
- `type_of_payment` — тип оплаты

**Назначение:** хранение информации о бронированиях без привязки к конкретному номеру до момента заселения.

---

### 2.7 RoomTypeAvailability (Доступность по дням)

**Поля:**
- `hotel`
- `room_type`
- `day`
- `free_rooms`

**Назначение:** хранение количества свободных номеров каждого типа по дням для корректного бронирования периодов.

---

### 2.8 CheckIn (Заселение)

**Поля:** даты заселения и выселения, клиент, номер, сотрудник, бронирование.

**Назначение:** фиксирует факт проживания клиента в конкретном номере.

---

### 2.9 CleaningTime (Уборка)

**Поля:** номер, сотрудник, дата, время уборки, статус уборки.

**Назначение:** учёт уборок номеров и синхронизация состояния уборки номера.

---

### 2.10 Profile (Профиль пользователя)

**Поля:**
- `user` — Django User
- `role` — client / admin / cleaner
- `hotel`
- `client`
- `staff`

**Назначение:** связывает учетную запись пользователя с его ролью и доменными сущностями.

---

## 3. Реализация API (Практическая работа 3.1)

API реализовано с использованием Django REST Framework:

- ViewSet и ModelViewSet
- сериализаторы DRF
- пагинация PageNumberPagination
- фильтрация через query-параметры
- атомарные транзакции для критичных операций

---

## 4. Аутентификация и авторизация (Djoser)

В проекте используется аутентификация по токенам с помощью библиотеки Djoser.

---

### 4.1 Получение токена

POST `/auth/token/login/`

Request:
{
  "username": "user",
  "password": "pass"
}

Response:
{
  "auth_token": "TOKEN_VALUE"
}

---

### 4.2 Выход (удаление токена)

POST `/auth/token/logout/`

Headers:
Authorization: Token TOKEN_VALUE

---

### 4.3 Информация о текущем пользователе

GET `/auth/users/me/`

Headers:
Authorization: Token TOKEN_VALUE

Response (пример):
{
  "id": 1,
  "username": "admin",
  "email": "admin@mail.com"
}

---

## 5. Документация API Endpoints (Практическая работа 3.2)

Базовый путь API: `/api/`

---

### 5.1 Публичные endpoints

Получить список отелей  
GET `/api/hotels/`

Описание: возвращает список всех отелей.

---

Получить отель по ID  
GET `/api/hotels/{id}/`

---

Типы номеров в отеле  
GET `/api/hotels/{id}/room-types/`

Возвращает отель и список типов номеров с количеством свободных номеров.

---

Проверка доступности типа номера  
GET `/api/hotels/{id}/room-types/{type_id}/availability?start=YYYY-MM-DD&end=YYYY-MM-DD`

Response:
{
  "hotel_id": 1,
  "room_type_id": 2,
  "period": {
    "start": "2026-02-01",
    "end": "2026-02-05"
  },
  "min_free_rooms": 2,
  "can_book": true
}

---

### 5.2 Client endpoints

Профиль клиента  
GET `/api/client/me/`

---

Создание бронирования  
POST `/api/hotels/{id}/room-types/{type_id}/book/`

Request:
{
  "date_start": "2026-02-01",
  "date_end": "2026-02-05",
  "type_of_payment": "Карта"
}

---

Мои бронирования  
GET `/api/client/my-bookings/`

---

Отмена бронирования  
POST `/api/client/bookings/{id}/cancel/`

---

### 5.3 Cleaner endpoints

Список номеров для уборки  
GET `/api/cleaner/rooms/`

---

Уборки за день  
GET `/api/cleaner/cleanings/?date=YYYY-MM-DD`

---

Добавить или обновить уборку  
POST `/api/cleaner/cleanings/`

---

Удалить уборку  
DELETE `/api/cleaner/cleanings/{id}/`

---

### 5.4 Admin endpoints

Список номеров  
GET `/api/admin/rooms/`

Поддерживает фильтрацию и пагинацию.

---

Список бронирований  
GET `/api/admin/bookings/`

---

Заселение клиента  
POST `/api/admin/bookings/{id}/checkin/`

---

Выселение клиента  
POST `/api/admin/bookings/{id}/checkout/`

---

Переселение клиента  
POST `/api/admin/bookings/{id}/change-room/`

---

Управление уборщиками  
GET `/api/admin/cleaners/`
POST `/api/admin/cleaners/{staff_id}/fire`

---

Управление уборками  
GET `/api/admin/cleanings/`
PATCH `/api/admin/cleanings/{id}/`

---

## 6. Заключение

В ходе выполнения практических работ 3.1 и 3.2 была реализована полнофункциональная backend-система управления гостиницей:
- спроектирована и реализована модель базы данных средствами Django ORM
- реализован REST API с использованием Django REST Framework
- настроена аутентификация и авторизация через Djoser
- реализованы бизнес-процессы бронирования, заселения, уборки и управления персоналом
- подготовлена подробная документация API в формате Markdown

Разработанная система готова к использованию и дальнейшему расширению, включая реализацию клиентской части в лабораторной работе №4.